# Security Policy

## 1. Prop√≥sito

Este documento define las pol√≠ticas de seguridad del proyecto con el objetivo de mitigar los riesgos identificados en el **OWASP Top 10 (2021/2024)**, con especial √©nfasis en **A02: Cryptographic Failures**, y extendi√©ndose a los controles necesarios desde **A03 en adelante**.

El contenido sirve como:

* Evidencia para auditor√≠as de seguridad (OWASP, ISO/IEC 27001, revisiones t√©cnicas)
* Gu√≠a para desarrolladores actuales y futuros
* Base de revisi√≥n peri√≥dica de controles de seguridad

---

## 2. Alcance

Aplica a:

* Backend: **Node.js + Express (JavaScript)**
* Frontend: **React**
* Autenticaci√≥n basada en **JWT (Access + Refresh Token)**
* Comunicaci√≥n cliente-servidor v√≠a **HTTPS**

---

## 3. A02 ‚Äì Cryptographic Failures

### 3.1 Algoritmos criptogr√°ficos permitidos

El proyecto **solo permite algoritmos criptogr√°ficos considerados seguros y vigentes**:

* Hash de contrase√±as: `bcrypt` (cost factor ‚â• 10)
* Tokens JWT: `HS256` / `RS256` (seg√∫n configuraci√≥n)
* Generaci√≥n de entrop√≠a: `crypto.randomBytes`
* TLS: TLS 1.2 o superior

**Algoritmos expl√≠citamente prohibidos**:

* MD5
* SHA-1
* RC4
* DES / 3DES
* AES en modo ECB

---

### 3.2 Manejo de claves y secretos

* Ninguna clave criptogr√°fica se encuentra hardcodeada en el c√≥digo fuente.
* Todas las claves se obtienen desde variables de entorno.
* Se utilizan claves separadas para:

  * Access Token
  * Refresh Token
* Las claves cumplen con longitudes adecuadas (‚â• 256 bits para secretos sim√©tricos).

---

### 3.3 Tokens JWT

* Los **Access Tokens**:

  * Son de corta duraci√≥n
  * Se almacenan en `sessionStorage` del frontend
  * Se env√≠an exclusivamente por el header `Authorization`

* Los **Refresh Tokens**:

  * Se almacenan en cookies con:

    * `httpOnly: true`
    * `secure: true`
    * `sameSite` configurado seg√∫n entorno
  * Son rotados en cada uso
  * Se invalidan al cerrar sesi√≥n

---

### 3.4 Protecci√≥n contra CSRF

* Se implementa el patr√≥n **Double Submit Cookie**:

  * Cookie `csrfToken` accesible por frontend
  * Header `csrf-token` enviado expl√≠citamente
* La validaci√≥n se realiza con comparaci√≥n segura (`timingSafeEqual`).
* El endpoint de refresh token est√° protegido contra CSRF.

---

### 3.5 Transporte seguro (TLS)

* Todo el tr√°fico se realiza exclusivamente sobre HTTPS.
* No se permite transmisi√≥n de tokens ni credenciales sobre HTTP.
* En producci√≥n se forzar√° TLS mediante infraestructura y/o proxy inverso.

---

### 3.6 Logging seguro

* Nunca se registran:

  * Contrase√±as
  * Tokens JWT
  * Refresh tokens
  * Claves criptogr√°ficas
* Los logs se consideran datos sensibles y se protegen adecuadamente.

---

### 3.7 Revisi√≥n criptogr√°fica peri√≥dica

La configuraci√≥n criptogr√°fica se revisa peri√≥dicamente para verificar:

* Algoritmos vigentes y no obsoletos
* Tama√±os de clave adecuados
* Uso correcto de randomness
* Configuraci√≥n TLS actualizada

---

## 4. A03 ‚Äì Injection

* Uso de ORM / query builders para acceso a datos
* Validaci√≥n y sanitizaci√≥n de entradas

Prevenir vulnerabilidades de inyecci√≥n (SQL, NoSQL, ORM, Command Injection, Mass Assignment) asegurando que toda entrada proveniente del cliente sea validada expl√≠citamente antes de ser procesada por la aplicaci√≥n.

Alcance

Esta pol√≠tica aplica a todas las entradas externas recibidas por la aplicaci√≥n, incluyendo pero no limitado a:

req.body

req.params

req.query

req.headers

req.cookies

Controles implementados
1. Validaci√≥n centralizada de entrada

Toda ruta expuesta por la API DEBE aplicar un middleware de validaci√≥n previo al controller, basado en esquemas expl√≠citos.

No se permite acceso directo a req.body, req.params o req.query desde la l√≥gica de negocio sin validaci√≥n previa.

La validaci√≥n se realiza mediante esquemas declarativos (Joi u otro validador equivalente).

2. Whitelisting estricto de campos

La aplicaci√≥n utiliza listas blancas (whitelisting) para definir qu√© campos son aceptados por cada endpoint.

Solo se permiten los campos definidos en el esquema de validaci√≥n.

Campos adicionales enviados por el cliente son rechazados autom√°ticamente.

No se utilizan listas negras.

Esto mitiga:

Inyecciones indirectas

Mass Assignment

Manipulaci√≥n de payloads

3. Validaci√≥n por tipo, formato, longitud y rango

Cada campo de entrada es validado expl√≠citamente seg√∫n:

Tipo de dato esperado

Longitud m√≠nima y m√°xima

Formato (email, fecha, UUID, etc.)

Reglas de obligatoriedad

No se aceptan valores impl√≠citos, coerci√≥n silenciosa ni datos parcialmente v√°lidos.

4. Corte temprano del flujo (Fail Fast)

Si la validaci√≥n falla:

La petici√≥n se rechaza inmediatamente con c√≥digo 400 Bad Request

El request NO alcanza la capa de controladores ni servicios

No se ejecuta l√≥gica de negocio ni consultas a bases de datos

Esto reduce la superficie de ataque y evita que payloads maliciosos lleguen a capas sensibles.

5. Mensajes de error controlados

Los errores de validaci√≥n:

No exponen estructuras internas

No revelan detalles de implementaci√≥n

Devuelven √∫nicamente mensajes de validaci√≥n controlados

6. Separaci√≥n entre validaci√≥n y l√≥gica de negocio

La validaci√≥n de entrada est√° desacoplada de:

Controllers

Services

Repositories / DAOs

Esto garantiza consistencia, reutilizaci√≥n y cumplimiento uniforme de la pol√≠tica de seguridad.

Riesgos mitigados

SQL Injection

NoSQL Injection

ORM Injection

Command Injection

Mass Assignment

Manipulaci√≥n de payloads

Bypass de reglas de negocio por input no validado

Cumplimiento OWASP

Esta implementaci√≥n cumple con los controles recomendados por OWASP Top 10 2021 ‚Äì A03: Injection, espec√≠ficamente:

Validaci√≥n estricta de entrada

Uso de whitelisting

Rechazo de datos inesperados

Reducci√≥n de superficie de ataque desde el input
* No se construyen queries din√°micas sin control

 
Control de exposici√≥n de registros (Data Exposure Control)

La aplicaci√≥n implementa controles expl√≠citos para evitar la exposici√≥n masiva de registros como consecuencia de consultas manipuladas o no acotadas, mitigando escenarios comunes de explotaci√≥n asociados a A03: Injection. Todas las operaciones de lectura que soportan paginaci√≥n utilizan valores de limit y offset validados, tipados y acotados previamente, impidiendo que el cliente fuerce consultas sin l√≠mites o con rangos arbitrarios. El acceso a datos se realiza exclusivamente mediante ORMs, query builders o consultas parametrizadas, evitando la interpolaci√≥n directa de valores provenientes del cliente. Adicionalmente, el total de registros (count) requerido para paginaci√≥n se obtiene mediante consultas controladas y separadas, garantizando que la l√≥gica de conteo no reutilice ni exponga consultas din√°micas no validadas. Este enfoque reduce la superficie de ataque, previene enumeraci√≥n de datos y asegura que el sistema permanezca resiliente incluso ante intentos de manipulaci√≥n de par√°metros de paginaci√≥n o filtrado.

Validaci√≥n fuerte de todos los par√°metros

Validar:

Query string

Path params

Headers

JSON bodies

Cookies

Incluso en APIs publicadas o microservicios internos.
üëâ Haz revisi√≥n de c√≥digo para confirmar validaciones en todos los endpoints.

---

## 5. A04 ‚Äì Insecure Design

* La arquitectura separa responsabilidades (controllers, services, middlewares)
* Los controles de seguridad se aplican por defecto (deny by default)
* Las decisiones criptogr√°ficas est√°n centralizadas

---

## 6. A05 ‚Äì Security Misconfiguration

* Uso de `helmet` para encabezados de seguridad
* Configuraci√≥n expl√≠cita de CSP
* Deshabilitaci√≥n de informaci√≥n sensible en headers
* Configuraci√≥n estricta de CORS

---

## 7. A06 ‚Äì Vulnerable and Outdated Components

* Dependencias auditadas peri√≥dicamente
* Uso de herramientas como `npm audit`
* Actualizaci√≥n activa de librer√≠as cr√≠ticas

---

## 8. A07 ‚Äì Identification and Authentication Failures

* Autenticaci√≥n basada en tokens
* Hash seguro de contrase√±as
* Separaci√≥n entre access y refresh tokens
* Revocaci√≥n de sesi√≥n al cerrar sesi√≥n

---

## 9. A08 ‚Äì Software and Data Integrity Failures

* Dependencias obtenidas de repositorios oficiales
* Uso de lockfiles
* No ejecuci√≥n de c√≥digo remoto din√°mico

---

## 10. A09 ‚Äì Security Logging and Monitoring Failures

* Logging centralizado
* Registro de eventos relevantes de seguridad
* Registro de violaciones CSP

---

## 11. A10 ‚Äì Server-Side Request Forgery (SSRF)

* No se permiten URLs arbitrarias proporcionadas por el usuario
* Validaci√≥n estricta de destinos externos

---

## 12. Reporte de vulnerabilidades

Las vulnerabilidades deben ser reportadas de forma responsable mediante los canales definidos por el equipo del proyecto.

---

## 13. Revisi√≥n del documento

Este documento ser√° revisado y actualizado cuando:

* Cambien los requisitos de seguridad
* Se modifique la arquitectura
* Se detecten nuevas vulnerabilidades relevantes

---

**√öltima actualizaci√≥n:** YYYY-MM-DD
